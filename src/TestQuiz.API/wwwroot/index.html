<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TestQuiz App</title>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-muted: #6b7280;
            --danger: #ef4444;
            --success: #10b981;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.5;
        }

        /* --- NAVBAR --- */
        .navbar {
            background: var(--card-bg);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .brand {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-actions button {
            margin-left: 10px;
        }

        /* --- BUTTONS --- */
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

            .btn-primary:hover {
                background-color: var(--primary-hover);
            }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

            .btn-outline:hover {
                background: #eef2ff;
            }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-muted);
        }

            .btn-ghost:hover {
                color: var(--text-main);
            }

        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.85rem;
        }

        /* --- CONTAINER --- */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        /* --- TEST GRID --- */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: var(--card-bg);
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            border-left: 5px solid var(--primary);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

            .card:hover {
                transform: translateY(-3px);
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            }

            .card h3 {
                margin-bottom: 0.5rem;
                color: var(--text-main);
            }

            .card p {
                color: var(--text-muted);
                font-size: 0.9rem;
                margin-bottom: 1rem;
                flex-grow: 1;
            }

        .meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: var(--text-muted);
            border-top: 1px solid #e5e7eb;
            padding-top: 10px;
            margin-top: 10px;
        }

        .badge {
            background: #e0e7ff;
            color: var(--primary);
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 0.8rem;
        }

        /* --- TEST DETAIL VIEW --- */
        #detailView {
            display: none;
            background: white;
            padding: 3rem;
            border-radius: 1rem;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: var(--shadow);
            text-align: center;
        }

            #detailView h2 {
                font-size: 2.5rem;
                color: var(--primary);
                margin-bottom: 1rem;
            }

            #detailView .desc {
                font-size: 1.2rem;
                color: var(--text-muted);
                margin-bottom: 2rem;
            }

            #detailView .info-box {
                background: #f9fafb;
                padding: 1.5rem;
                border-radius: 0.5rem;
                margin-bottom: 2rem;
                display: inline-block;
                text-align: left;
            }

        .actions-row {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        /* --- EXAM VIEW (NEW) --- */
        #examView {
            display: none;
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: var(--shadow);
        }

        .question-card h3 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-main);
        }

        .exam-answers {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .exam-answer-option {
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

            .exam-answer-option:hover {
                background-color: #f9fafb;
                border-color: var(--primary);
            }

            .exam-answer-option.selected {
                background-color: #e0e7ff;
                border-color: var(--primary);
                color: var(--primary);
                font-weight: bold;
            }

        /* --- MODALS --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(2px);
        }

        .modal {
            background: white;
            padding: 2rem;
            border-radius: 0.75rem;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-lg {
            max-width: 700px;
        }

        .modal h2 {
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .form-group {
            margin-bottom: 1rem;
        }

            .form-group label {
                display: block;
                font-size: 0.9rem;
                margin-bottom: 0.5rem;
                color: var(--text-muted);
            }

            .form-group input, .form-group textarea {
                width: 100%;
                padding: 0.75rem;
                border: 1px solid #d1d5db;
                border-radius: 0.375rem;
                outline: none;
            }

                .form-group input:focus {
                    border-color: var(--primary);
                    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
                }

        /* --- ANSWER ROWS STYLE --- */
        .answer-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            background: #f9fafb;
            padding: 10px;
            border-radius: 6px;
        }

            .answer-row input[type="text"] {
                flex-grow: 1;
            }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            color: var(--text-muted);
            cursor: pointer;
        }

        .error-msg {
            color: var(--danger);
            font-size: 0.85rem;
            margin-top: 0.5rem;
            text-align: center;
            min-height: 1.2em;
        }

        .link {
            color: var(--primary);
            cursor: pointer;
            text-decoration: underline;
            font-size: 0.9rem;
            text-align: center;
            display: block;
            margin-top: 1rem;
        }

        /* Utility */
        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="brand">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
            TestQuiz
        </div>
        <div class="nav-actions" id="navActions">
        </div>
    </nav>

    <div class="container">

        <div id="listView" class="fade-in">
            <div class="header-section">
                <h1>Доступні тести</h1>
                <button class="btn btn-primary" onclick="openCreateModal()">+ Створити тест</button>
            </div>
            <div id="testsGrid" class="grid">
                <p>Завантаження...</p>
            </div>
        </div>

        <div id="detailView" class="fade-in">
            <h2 id="dTitle">Назва тесту</h2>
            <p id="dDesc" class="desc">Опис...</p>

            <div class="info-box">
                <p><strong>Автор:</strong> <span id="dAuthor">Author</span></p>
                <p><strong>Кількість питань:</strong> <span id="dCount">0</span></p>
                <p><strong>ID Тесту:</strong> <span id="dId">0</span></p>
            </div>
            <br>

            <div class="actions-row">
                <button class="btn btn-outline" onclick="openQuestionModal()">+ Додати питання</button>
                <button class="btn btn-primary" onclick="startExam()">Почати тестування</button>
            </div>

            <button class="btn btn-ghost" onclick="showListView()">← Повернутися до списку</button>
        </div>

        <div id="examView" class="fade-in">
            <div class="question-card">
                <div style="display:flex; justify-content:space-between; margin-bottom: 10px; color: var(--text-muted);">
                    <span>Тестування</span>
                    <button class="btn btn-ghost btn-sm" onclick="finishExamEarly()">Перервати</button>
                </div>

                <h3 id="examQuestionText">Завантаження питання...</h3>

                <div id="examOptionsContainer" class="exam-answers">
                </div>

                <div style="text-align: right;">
                    <button id="nextBtn" class="btn btn-primary" onclick="submitAndNext()">Відповісти</button>
                </div>
            </div>
        </div>

    </div>

    <div id="authModal" class="modal-overlay">
        <div class="modal">
            <h2 id="authTitle">Вхід в систему</h2>

            <div class="form-group">
                <label>UserName</label>
                <input type="text" id="authName" placeholder="Введіть ім'я">
            </div>

            <div class="form-group hidden" id="emailGroup">
                <label>Email</label>
                <input type="email" id="authEmail" placeholder="Введіть email">
            </div>

            <div class="form-group">
                <label>Password</label>
                <input type="password" id="authPass" placeholder="••••••••">
            </div>

            <p id="authError" class="error-msg"></p>

            <button class="btn btn-primary" style="width: 100%" onclick="submitAuth()">Увійти</button>

            <a class="link" onclick="toggleAuthMode()" id="authSwitch">Немає акаунту? Зареєструватися</a>
            <button class="btn btn-ghost" style="width: 100%; margin-top: 10px;" onclick="closeModal('authModal')">Скасувати</button>
        </div>
    </div>

    <div id="createModal" class="modal-overlay">
        <div class="modal">
            <h2>Новий тест</h2>
            <div class="form-group">
                <label>Назва</label>
                <input type="text" id="newTitle">
            </div>
            <div class="form-group">
                <label>Опис</label>
                <textarea id="newDesc" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>Автор (псевдонім)</label>
                <input type="text" id="newAuthor" value="Anonymous">
            </div>
            <button class="btn btn-primary" style="width: 100%" onclick="submitCreateTest()">Зберегти</button>
            <button class="btn btn-ghost" style="width: 100%; margin-top: 10px;" onclick="closeModal('createModal')">Скасувати</button>
        </div>
    </div>

    <div id="questionModal" class="modal-overlay">
        <div class="modal modal-lg">
            <h2>Додати питання</h2>

            <div class="form-group">
                <label>Текст питання</label>
                <input type="text" id="qText" placeholder="Наприклад: Скільки буде 2+2?">
            </div>

            <div class="form-group">
                <label>Варіанти відповідей</label>
                <div id="answersContainer">
                </div>
                <button class="btn btn-outline btn-sm" onclick="addAnswerRow()">+ Додати варіант</button>
            </div>

            <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="submitNewQuestion()">Зберегти питання</button>
            <button class="btn btn-ghost" style="width: 100%; margin-top: 10px;" onclick="closeModal('questionModal')">Скасувати</button>
        </div>
    </div>

    <script>
        // --- CONFIG ---
        const API_URL = "https://localhost:7000/api";

        // --- STATE ---
        let isRegisterMode = false;
        let pendingTestId = null;
        let currentOpenTestId = null;

        // Стан для екзамену
        let currentSessionId = null;
        let currentSelectedAnswer = null;

        // --- HELPERS (Token Handling) ---
        function isTokenExpired(token) {
            if (!token) return true;
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function (c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));

                const payload = JSON.parse(jsonPayload);
                const currentTime = Math.floor(Date.now() / 1000);
                return payload.exp < currentTime;
            } catch (e) {
                console.error("Помилка перевірки токена", e);
                return true;
            }
        }

        async function apiFetch(endpoint, options = {}) {
            const token = getToken();
            const headers = options.headers || {};

            if (token) {
                if (isTokenExpired(token)) {
                    logout(true);
                    openAuthModal(false);
                    throw new Error("Ваша сесія закінчилась.");
                }
                headers['Authorization'] = `Bearer ${token}`;
            }

            const config = {
                ...options,
                headers: {
                    'Content-Type': 'application/json',
                    ...headers
                }
            };

            const response = await fetch(API_URL + endpoint, config);

            if (response.status === 401) {
                logout(true);
                openAuthModal(false);
                throw new Error("Сесія недійсна. Увійдіть знову.");
            }

            return response;
        }

        // --- INIT ---
        window.onload = () => {
            const token = getToken();
            if (token && isTokenExpired(token)) {
                logout(true);
            }
            renderNav();
            loadTests();
        };

        // --- AUTH LOGIC ---
        function getToken() { return localStorage.getItem('jwtToken'); }
        function getUserName() { return localStorage.getItem('userName') || 'User'; }

        function renderNav() {
            const nav = document.getElementById('navActions');
            const token = getToken();

            if (token) {
                nav.innerHTML = `
                                    <span style="color: var(--text-muted); margin-right: 10px;">Привіт, <b>${getUserName()}</b></span>
                                    <button class="btn btn-outline" onclick="logout(false)">Вийти</button>
                                `;
            } else {
                nav.innerHTML = `
                                    <button class="btn btn-ghost" onclick="openAuthModal(false)">Вхід</button>
                                    <button class="btn btn-primary" onclick="openAuthModal(true)">Реєстрація</button>
                                `;
            }
        }

        function logout(silent = false) {
            localStorage.removeItem('jwtToken');
            localStorage.removeItem('userName');
            renderNav();
            showListView();
            if (!silent) alert('Ви вийшли з системи');
        }

        async function submitAuth() {
            const name = document.getElementById('authName').value;
            const pass = document.getElementById('authPass').value;
            const email = document.getElementById('authEmail').value;
            const errorEl = document.getElementById('authError');
            errorEl.innerText = "";

            const endpoint = isRegisterMode ? '/auth/register' : '/auth/login';
            const body = isRegisterMode
                ? { userName: name, email: email, password: pass }
                : { userName: name, password: pass };

            try {
                const res = await fetch(API_URL + endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                const data = await res.json();

                if (!res.ok) throw new Error(data.message || data.error || "Помилка запиту");

                if (isRegisterMode) {
                    alert("Реєстрація успішна! Тепер увійдіть.");
                    toggleAuthMode();
                } else {
                    localStorage.setItem('jwtToken', data.token);
                    localStorage.setItem('userName', name);
                    closeModal('authModal');
                    renderNav();

                    if (pendingTestId) {
                        loadTestDetails(pendingTestId);
                        pendingTestId = null;
                    }
                }
            } catch (err) {
                errorEl.innerText = err.message;
            }
        }

        // --- DATA LOGIC ---

        async function loadTests() {
            const grid = document.getElementById('testsGrid');
            grid.innerHTML = '<p>Завантаження...</p>';

            try {
                const res = await apiFetch('/tests');
                if (!res.ok) throw new Error("API Error");
                const tests = await res.json();

                grid.innerHTML = '';
                tests.forEach(test => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.onclick = () => tryOpenTest(test.id);
                    card.innerHTML = `
                                        <h3>${test.title}</h3>
                                        <p>${test.description || 'Опис відсутній'}</p>
                                        <div class="meta">
                                            <span>by ${test.author}</span>
                                            <span class="badge">Питань: ${test.questionsCount}</span>
                                        </div>
                                    `;
                    grid.appendChild(card);
                });
            } catch (err) {
                if (err.message.includes("Сесія")) return;
                grid.innerHTML = '<p style="color:red">Не вдалося завантажити список.</p>';
            }
        }

        function tryOpenTest(id) {
            const token = getToken();
            if (!token || isTokenExpired(token)) {
                pendingTestId = id;
                if (token) logout(true);
                openAuthModal(false);
            } else {
                loadTestDetails(id);
            }
        }

        async function loadTestDetails(id) {
            try {
                const res = await apiFetch(`/tests/${id}`);
                if (!res.ok) throw new Error("Помилка");

                const test = await res.json();

                currentOpenTestId = test.id;

                document.getElementById('listView').classList.add('hidden');
                document.getElementById('examView').style.display = 'none'; // Ensure exam is closed
                document.getElementById('detailView').style.display = 'block';

                document.getElementById('dTitle').innerText = test.title;
                document.getElementById('dDesc').innerText = test.description || "";
                document.getElementById('dAuthor').innerText = test.author;
                document.getElementById('dCount').innerText = test.questionsCount;
                document.getElementById('dId').innerText = test.id;

            } catch (err) {
                if (!err.message.includes("Сесія")) {
                    alert("Не вдалося завантажити тест");
                }
            }
        }

        async function submitCreateTest() {
            const dto = {
                title: document.getElementById('newTitle').value,
                description: document.getElementById('newDesc').value,
                author: document.getElementById('newAuthor').value
            };

            try {
                const res = await apiFetch('/tests', {
                    method: 'POST',
                    body: JSON.stringify(dto)
                });

                if (!res.ok) throw new Error("Помилка створення");

                closeModal('createModal');
                loadTests();
                alert("Тест створено!");
            } catch (e) {
                if (!e.message.includes("Сесія")) {
                    alert("Помилка: " + e.message);
                }
            }
        }

        // --- QUESTION & ANSWERS ADMIN LOGIC ---

        function openQuestionModal() {
            document.getElementById('qText').value = '';
            document.getElementById('answersContainer').innerHTML = '';
            addAnswerRow();
            addAnswerRow();
            document.getElementById('questionModal').style.display = 'flex';
        }

        function addAnswerRow() {
            const container = document.getElementById('answersContainer');
            const row = document.createElement('div');
            row.className = 'answer-row fade-in';
            row.innerHTML = `
                        <input type="text" class="ans-text" placeholder="Текст відповіді">
                        <label class="checkbox-wrapper">
                            <input type="checkbox" class="ans-correct"> Вірна
                        </label>
                        <button class="btn btn-ghost btn-sm" onclick="this.parentElement.remove()" style="color: var(--danger)">✕</button>
                    `;
            container.appendChild(row);
        }

        async function submitNewQuestion() {
            const title = document.getElementById('qText').value;
            if (!title) {
                alert("Введіть текст питання");
                return;
            }

            const rows = document.querySelectorAll('#answersContainer .answer-row');
            const answers = [];

            rows.forEach(row => {
                const text = row.querySelector('.ans-text').value;
                const isCorrect = row.querySelector('.ans-correct').checked;
                if (text) {
                    answers.push({ text: text, isCorrect: isCorrect });
                }
            });

            if (answers.length < 2) {
                alert("Додайте хоча б 2 варіанти відповідей");
                return;
            }

            const dto = {
                title: title,
                testId: currentOpenTestId,
                answers: answers
            };

            try {
                const res = await apiFetch('/questions', {
                    method: 'POST',
                    body: JSON.stringify(dto)
                });

                if (!res.ok) throw new Error("Не вдалося зберегти питання");

                closeModal('questionModal');
                alert("Питання успішно додано!");
                loadTestDetails(currentOpenTestId);

            } catch (e) {
                if (!e.message.includes("Сесія")) {
                    alert("Помилка: " + e.message);
                }
            }
        }

        async function startExam() {
            if (!currentOpenTestId) return;

            try {
                // Викликаємо метод контролера ExamController: [HttpPost("{examId}/start")]
                const res = await apiFetch(`/exam/${currentOpenTestId}/start`, {
                    method: 'POST'
                });

                if (!res.ok) throw new Error("Не вдалося почати тест");

                // Контролер повертає GUID сесії (рядок)
                const sessionId = await res.json();
                currentSessionId = sessionId;

                // Перемикаємо UI
                document.getElementById('detailView').style.display = 'none';
                document.getElementById('examView').style.display = 'block';

                // Завантажуємо перше питання
                loadNextQuestion();

            } catch (e) {
                alert("Помилка старту тесту: " + e.message);
            }
        }

        async function loadNextQuestion() {
            try {
                document.getElementById('examQuestionText').innerText = "Завантаження...";
                document.getElementById('examOptionsContainer').innerHTML = "";
                document.getElementById('nextBtn').disabled = true;
                currentSelectedAnswer = null;

                // Викликаємо метод контролера: [HttpGet("next")]
                const res = await apiFetch(`/exam/next?sessionId=${currentSessionId}`);

                // Якщо 204 No Content або null - тест завершено
                if (res.status === 204) {
                    finishExamUI();
                    return;
                }

                const question = await res.json();

                // Якщо прийшов null в body
                if (!question) {
                    finishExamUI();
                    return;
                }

                renderExamQuestion(question);

            } catch (e) {
                console.error(e);
                alert("Помилка отримання питання");
                finishExamEarly();
            }
        }

        function renderExamQuestion(question) {
            document.getElementById('examQuestionText').innerText = question.title;
            const container = document.getElementById('examOptionsContainer');

            // Припускаємо, що question.answers - це масив об'єктів { id, text }
            // Якщо answers немає, перевірте структуру DTO
            if (question.answers && question.answers.length > 0) {
                question.answers.forEach(ans => {
                    const el = document.createElement('div');
                    el.className = 'exam-answer-option';
                    el.innerText = ans.text;
                    el.onclick = () => selectAnswer(el, ans.id);
                    container.appendChild(el);
                });
            } else {
                container.innerHTML = "<p>Варіанти відповідей відсутні (помилка даних)</p>";
            }
        }

        function selectAnswer(element, answerId) {
            // Знімаємо виділення з усіх
            const all = document.querySelectorAll('.exam-answer-option');
            all.forEach(x => x.classList.remove('selected'));

            // Виділяємо поточний
            element.classList.add('selected');
            currentSelectedAnswer = answerId;
            document.getElementById('nextBtn').disabled = false;
        }

        async function submitAndNext() {
            // ТУТ МАЄ БУТИ ЛОГІКА ВІДПРАВКИ ВІДПОВІДІ НА СЕРВЕР
            // Наприклад: await apiFetch('/exam/submit', { body: { sessionId, answerId: currentSelectedAnswer }})

            // Оскільки в наданому контролері методу Submit немає, ми просто йдемо далі.
            // (Але в реальному проекті обов'язково додай endpoint SubmitAnswer!)

            await loadNextQuestion();
        }

        function finishExamUI() {
            alert("Тест завершено! Вітаємо.");
            showListView();
        }

        function finishExamEarly() {
            if (confirm("Ви впевнені, що хочете перервати тест?")) {
                showListView();
            }
        }


        // --- UI UTILS ---

        function showListView() {
            document.getElementById('detailView').style.display = 'none';
            document.getElementById('examView').style.display = 'none';
            document.getElementById('listView').classList.remove('hidden');
        }

        function openAuthModal(register) {
            isRegisterMode = register;
            const modal = document.getElementById('authModal');
            const title = document.getElementById('authTitle');
            const emailGroup = document.getElementById('emailGroup');
            const btnText = document.querySelector('#authModal .btn-primary');
            const switchLink = document.getElementById('authSwitch');

            modal.style.display = 'flex';
            document.getElementById('authError').innerText = "";
            document.getElementById('authPass').value = "";

            if (register) {
                title.innerText = "Реєстрація";
                emailGroup.classList.remove('hidden');
                btnText.innerText = "Зареєструватися";
                switchLink.innerText = "Вже є акаунт? Увійти";
            } else {
                title.innerText = "Вхід";
                emailGroup.classList.add('hidden');
                btnText.innerText = "Увійти";
                switchLink.innerText = "Немає акаунту? Зареєструватися";
            }
        }

        function toggleAuthMode() {
            openAuthModal(!isRegisterMode);
        }

        function openCreateModal() {
            const token = getToken();
            if (!token || isTokenExpired(token)) {
                if (token) logout(true);
                openAuthModal(false);
                return;
            }
            document.getElementById('createModal').style.display = 'flex';
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        window.onclick = function (event) {
            if (event.target.classList.contains('modal-overlay')) {
                event.target.style.display = "none";
            }
        }
    </script>
</body>
</html>